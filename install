#!/usr/bin/env bash
#
# install - Backward-compatible wrapper for new dotfiles system
#

set -o errexit
set -o nounset
set -o pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Show migration message
cat <<'EOF'
╔══════════════════════════════════════════════════════════╗
║                                                          ║
║  Dotfiles has been modernized!                          ║
║                                                          ║
║  New commands:                                           ║
║    make setup      - First-time setup                   ║
║    make install    - Install default modules            ║
║    make update     - Update all modules                 ║
║    make doctor     - Health check                       ║
║    make list       - List available modules             ║
║    make status     - Show what's installed              ║
║                                                          ║
║  Or use the CLI directly:                               ║
║    ./bin/dotfiles install                               ║
║    ./bin/dotfiles doctor                                ║
║                                                          ║
╚══════════════════════════════════════════════════════════╝

EOF

# Ask if they want to proceed with new system
read -rp "Run the new setup now? [Y/n] " response
response="${response:-y}"

if [[ "${response}" =~ ^[Yy]$ ]]; then
    echo ""
    echo "Running setup..."
    "${SCRIPT_DIR}/bin/dotfiles-setup"

    echo ""
    read -rp "Install default modules (fonts, go, git, oh-my-posh, fnm)? [Y/n] " install_response
    install_response="${install_response:-y}"

    if [[ "${install_response}" =~ ^[Yy]$ ]]; then
        echo ""
        "${SCRIPT_DIR}/bin/dotfiles" install
    fi
else
    echo ""
    echo "No problem! When you're ready:"
    echo "  ./bin/dotfiles-setup"
    echo "  ./bin/dotfiles install"
    echo ""
    echo "The old install script is available at: ./install.old"
fi
